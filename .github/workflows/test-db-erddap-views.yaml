name: Test ERDDAP Database Views
on:
  pull_request:
    paths:
      - views/**
    branches:
      - development
      - master
jobs:
  test:
    name: Test ERDDAP Views
    runs-on: ubuntu-latest
    if: false ## remove to actually run. just for safety. 
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Install uv
        uses: astral-sh/setup-uv@v4
        
      - name: Set up Python and install dependencies
        run: |
          uv sync
        
      - name: Validate templates can be rendered
        run: |
          uv run python generate_view_sql.py --jinja-only

      - name: Test DB views
        env:
          PGHOST: db.hakai.org
          PGPORT: 5432
          PGDATABASE: hakai
          PGUSER: hakai_erddap_user
          PGPASSWORD: ${secrets.PGPASSWORD}
        run: (echo "BEGIN:"; cat views/*.sql; echo "ROLLBACK;") | psql
